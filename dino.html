<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Jeu du Dino (Offline)</title>
    <style>
      body {
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #f7f7f7;
        font-family: Arial, sans-serif;
      }
      #game {
        border: 2px solid #333;
        background: #fff;
      }
      .info {
        position: absolute;
        top: 20px;
        text-align: center;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div class="info">
      <h2>Jeu du Dino</h2>
      <p>Espace pour sauter (tapote = plus haut) — vitesse augmente</p>
    </div>

    <canvas id="game" width="600" height="200"></canvas>

    <script>
      const canvas = document.getElementById("game");
      const ctx = canvas.getContext("2d");

      const GROUND_Y = 150;

      let dino = {
        x: 50,
        y: GROUND_Y,
        width: 30,
        height: 30,
        vy: 0,
        jumping: false,
      };

      let obstacles = [];
      let gravity = 0.8;
      let speed = 5;
      let score = 0;
      let gameOver = false;
      let frame = 0;

      // gestion saut variable
      let jumpCharge = 0;
      const MAX_JUMP_CHARGE = 6;

      document.addEventListener("keydown", (e) => {
        if (e.code === "Space" && !gameOver) {
          if (!dino.jumping) {
            dino.jumping = true;
            jumpCharge = Math.min(jumpCharge + 1, MAX_JUMP_CHARGE);
            dino.vy = -12 - jumpCharge * 1.2;
          }
        }

        if (gameOver && e.code === "Space") {
          resetGame();
        }
      });

      function resetGame() {
        obstacles = [];
        speed = 5;
        score = 0;
        frame = 0;
        jumpCharge = 0;
        dino.y = GROUND_Y;
        dino.vy = 0;
        dino.jumping = false;
        gameOver = false;
      }

      function spawnObstacle() {
        const type = Math.random();
        let obstacle = {};

        if (type < 0.6) {
          obstacle = { width: 20, height: 30, y: GROUND_Y };
        } else if (type < 0.85) {
          obstacle = { width: 30, height: 45, y: GROUND_Y - 15 };
        } else {
          obstacle = { width: 30, height: 20, y: GROUND_Y - 30 };
        }

        // espacement parfois très court
        const spacing = Math.random() < 0.4 ? 40 : 120;
        obstacle.x = canvas.width + spacing;
        obstacles.push(obstacle);
      }

      function update() {
        if (gameOver) return;

        frame++;

        // accélération progressive
        if (frame % 300 === 0) {
          speed += 0.8;
        }

        // physique du dino
        dino.y += dino.vy;
        dino.vy += gravity;

        if (dino.y >= GROUND_Y) {
          dino.y = GROUND_Y;
          dino.vy = 0;
          dino.jumping = false;
          jumpCharge = 0;
        }

        // génération obstacles
        if (frame % 110 === 0) {
          spawnObstacle();
        }

        // déplacement obstacles
        obstacles.forEach((o) => (o.x -= speed));
        obstacles = obstacles.filter((o) => o.x + o.width > 0);

        // collisions
        obstacles.forEach((o) => {
          if (
            dino.x < o.x + o.width &&
            dino.x + dino.width > o.x &&
            dino.y < o.y + o.height &&
            dino.y + dino.height > o.y
          ) {
            gameOver = true;
          }
        });

        score++;
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // sol
        ctx.fillStyle = "#555";
        ctx.fillRect(0, GROUND_Y + dino.height, canvas.width, 2);

        // dino
        ctx.fillStyle = "#000";
        ctx.fillRect(dino.x, dino.y, dino.width, dino.height);

        // obstacles
        obstacles.forEach((o) => {
          ctx.fillRect(o.x, o.y, o.width, o.height);
        });

        // UI
        ctx.fillStyle = "#000";
        ctx.fillText("Score : " + score, 10, 20);
        ctx.fillText("Vitesse : " + speed.toFixed(1), 500, 20);

        if (gameOver) {
          ctx.font = "20px Arial";
          ctx.fillText("Game Over - Appuie sur Espace", 130, 100);
        }
      }

      function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
      }

      loop();
    </script>
  </body>
</html>
