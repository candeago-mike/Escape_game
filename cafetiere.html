<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Hall MMI - Cafeti√®re</title>
    <script src="js/inventory.js"></script>
    <link rel="stylesheet" href="css/cafetiere.css">
  </head>

  <body>
    <div class="section">
      <!-- IMAGES -->
      <img class="bouton theFond" src="img/the/The.jpg" />
      <img class="bouton" src="img/the/The 1.png" />
      <img class="bouton" src="img/the/The 2.png" />
      <img class="bouton" src="img/the/The 3.png" />
      <img class="bouton" src="img/the/The 4.png" />
      <img class="bouton" src="img/the/The 5.png" />
      <img class="bouton" src="img/the/The 6.png" />
      <img class="bouton" src="img/the/The 7.png" />

      <!-- DIMINUER -->
      <div
        class="clickzone"
        data-index="1"
        style="top: 38%; left: 33%; width: 100px; height: 100px"
      ></div>
      <div
        class="clickzone"
        data-index="2"
        style="top: 57%; left: 33%; width: 100px; height: 100px"
      ></div>
      <div
        class="clickzone"
        data-index="3"
        style="top: 74%; left: 33%; width: 100px; height: 100px"
      ></div>

      <!-- AUGMENTER -->
      <div
        class="clickzone"
        data-index="4"
        style="top: 39%; left: 61%; width: 100px; height: 100px"
      ></div>
      <div
        class="clickzone"
        data-index="5"
        style="top: 57%; left: 61%; width: 100px; height: 100px"
      ></div>
      <div
        class="clickzone"
        data-index="6"
        style="top: 74%; left: 61%; width: 100px; height: 100px"
      ></div>
    </div>

    <!-- LIGNE GOBELET -->
    <div class="dose-line" style="top: 43%; left: 42%">
      <div class="bars" id="size-bars"></div>
    </div>

    <!-- LIGNE LAIT -->
    <div class="dose-line" style="top: 61%; left: 42%">
      <div class="bars" id="milk-bars"></div>
    </div>

    <!-- LIGNE SUCRE -->
    <div class="dose-line" style="top: 78%; left: 42%">
      <div class="bars" id="sugar-bars"></div>
    </div>

    <div
      id="validate"
      class="clickzone"
      data-index="7"
      style="top: 89%; left: 40%; width: 306px; height: 100px"
    ></div>
    <!-- POPUP -->
    <div class="popup-overlay" id="popup">
      <div class="popup" id="popup-content">
        <h2 id="popup-message"></h2>
        <button id="close-popup">Fermer</button>
      </div>
    </div>

    <script>
      let isSuccess = false;

      const zones = document.querySelectorAll(".clickzone");
      const boutons = document.querySelectorAll(".bouton");
      const fermer = document.getElementById("close-popup");
      let sizeIndex = 0; // 0-2
      let milk = 1; // 1-5
      let sugar = 1; // 1-5

      const sizeBars = document.getElementById("size-bars");
      const milkBars = document.getElementById("milk-bars");
      const sugarBars = document.getElementById("sugar-bars");
      const resultEl = document.getElementById("result");

      fermer.addEventListener("click", () => {
        popup.style.display = "none";

        if (isSuccess) {
          window.location.href = "hall-mmi.html";
        }
      });

      function renderSize() {
        sizeBars.innerHTML = "";
        for (let i = 0; i <= sizeIndex; i++) {
          const bar = document.createElement("div");
          bar.className = `bar active size-${i}`;
          sizeBars.appendChild(bar);
        }
      }

      function renderBars(container, count) {
        container.innerHTML = "";
        for (let i = 0; i < count; i++) {
          const bar = document.createElement("div");
          bar.className = "bar active";
          container.appendChild(bar);
        }
      }

      function updateUI() {
        renderSize();
        renderBars(milkBars, milk);
        renderBars(sugarBars, sugar);
      }

      zones.forEach((zone) => {
        const index = Number(zone.dataset.index);
        const bouton = boutons[index];

        zone.addEventListener("mouseenter", () => bouton.classList.add("glow"));
        zone.addEventListener("mouseleave", () =>
          bouton.classList.remove("glow")
        );

        zone.addEventListener("click", () => {
          switch (index) {
            case 1:
              sizeIndex = Math.max(0, sizeIndex - 1);
              break;
            case 4:
              sizeIndex = Math.min(2, sizeIndex + 1);
              break;
            case 2:
              milk = Math.max(1, milk - 1);
              break;
            case 5:
              milk = Math.min(5, milk + 1);
              break;
            case 3:
              sugar = Math.max(1, sugar - 1);
              break;
            case 6:
              sugar = Math.min(5, sugar + 1);
              break;
          }
          updateUI();
        });
      });

      const popup = document.getElementById("popup");
      const popupContent = document.getElementById("popup-content");
      const popupMessage = document.getElementById("popup-message");

      document.getElementById("validate").addEventListener("click", () => {
        popup.style.display = "flex";

        if (sizeIndex === 1 && milk === 2 && sugar === 5) {
          popupMessage.textContent = "üéâ Boisson parfaite !";
          popupContent.className = "popup success";

          Inventory.addItem("th√©");
          console.log("‚úÖ Th√© ajout√© √† l'inventaire");

          isSuccess = true; // ‚úÖ autorise la sortie
        } else {
          popupMessage.textContent = "‚ùå Mauvais dosage...";
          popupContent.className = "popup error";

          isSuccess = false; // ‚ùå emp√™che la sortie
        }
      });

      document.getElementById("close-popup").addEventListener("click", () => {
        popup.style.display = "none";
      });

      updateUI();
    </script>
  </body>
</html>
